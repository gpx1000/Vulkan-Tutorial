# Copyright (c) 2023 Sascha Willems
# SPDX-License-Identifier: CC-BY-SA-4.0

# Configure the Khronos Vulkan Samples Antora tree with transformed markup files

RMRF = rm -rf
CP = cp

# Antora ROOT module directory where files are copied
ROOT = modules/ROOT

# Some Antora related documentation files are fixed and and shouldn't be delete
EXCLUDE = 'index.adoc'

setup: setup_tutorial

setup_tutorial:
# In order to keep the image links we need to have the image folder inside the image folder (due to how Antora works)
	mkdir -p $(ROOT)/images/images
	rsync -a --delete ../images $(ROOT)/images
	rsync -a --delete ../attachments $(ROOT)
	mkdir -p $(ROOT)/pages
	rsync -a --delete --exclude ${EXCLUDE} ../en/ $(ROOT)/pages
# Use a python script to automat some file content changes that are necessary due to differences between Antora and github
	python3 make_helper.py

# @todo
# Files generated by 'setup' target
# ANTORA_GENERATED = \
#  	$(filter-out $(ROOT)/pages/index.adoc,$(wildcard $(ROOT)/pages/*.adoc)) \
#  	$(ROOT)/pages/extensions \
#  	$(ROOT)/images

# clean:
# 	$(RMRF) $(ANTORA_GENERATED)